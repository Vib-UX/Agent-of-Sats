# Agent of Sats

> **BTC-native strategy engine** exposed as an MCP server, with ERC‑8004 identity, Hyperliquid perps, Li.Fi routing, and Moltbook social reputation.

---

## Architecture Overview

**Agent of Sats** is an off-chain BTC strategy engine that trades Hyperliquid BTC perpetuals to capture basis/funding yield. Every decision, trade, and PnL snapshot is recorded in an append-only log (modelled after Hypercore) so that the full history is auditable and streamable.

The engine is exposed as an **MCP (Model Context Protocol) server**, allowing any AI agent or MCP-capable client (Claude Desktop, custom agents) to query performance, trigger strategies, and manage risk—all through a standardised tool interface.

**ERC‑8004** provides the on-chain identity and reputation layer. The agent registers its metadata (MCP endpoint, Moltbook profile, log URL, BTC public key) as an ERC‑8004 token. Over time, signed performance snapshots can be anchored into the on-chain reputation registry, creating a verifiable track record without moving strategy logic on-chain.

**Moltbook** serves as the social surface where the agent publishes PnL updates and trade signals, making it discoverable and followable by other agents and humans.

**Li.Fi** is integrated as a cross-chain routing interface so that deposits/withdrawals from any EVM chain can be quoted and routed into the strategy universe.

---

## Project Structure

```
Agent-of-Sats/
├── mcp_server/
│   ├── __init__.py
│   ├── __main__.py          # python -m mcp_server
│   └── server.py            # FastMCP app, tool & resource definitions
├── clients/
│   ├── __init__.py
│   ├── hyperliquid_client.py  # Hyperliquid perps wrapper
│   ├── moltbook_client.py     # Moltbook social API client
│   └── lifi_client.py         # Li.Fi cross-chain stub
├── store/
│   ├── __init__.py
│   └── performance_log.py   # Hypercore-like append-only log (SQLite)
├── erc8004/
│   ├── __init__.py
│   └── registration.py      # ERC-8004 metadata & Solidity sketch
├── run_server.py             # Convenience entrypoint
├── requirements.txt
├── .env.example
└── README.md
```

---

## Quick Start

### 1. Install dependencies

```bash
cd Agent-of-Sats
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 2. Configure environment

```bash
cp .env.example .env
# Edit .env and fill in your keys:
#   HYPERLIQUID_PRIVATE_KEY   – for live trading (leave blank for mock mode)
#   MOLTBOOK_API_KEY          – for real Moltbook posts (leave blank for mock)
#   LIFI_API_KEY              – for real Li.Fi quotes (leave blank for mock)
```

### 3. Run the MCP server

```bash
# Stdio transport (default, for Claude Desktop / MCP clients):
python run_server.py

# Or as a module:
python -m mcp_server
```

### 4. Configure in Claude Desktop

Add to your Claude Desktop MCP config (`claude_desktop_config.json`):

```json
{
  "mcpServers": {
    "agent-of-sats": {
      "command": "python",
      "args": ["/absolute/path/to/Agent-of-Sats/run_server.py"],
      "env": {
        "HYPERLIQUID_NETWORK": "testnet"
      }
    }
  }
}
```

### 5. Configure in Cursor

Add to your Cursor MCP settings (`.cursor/mcp.json`):

```json
{
  "mcpServers": {
    "agent-of-sats": {
      "command": "python",
      "args": ["/absolute/path/to/Agent-of-Sats/run_server.py"],
      "env": {
        "HYPERLIQUID_NETWORK": "testnet"
      }
    }
  }
}
```

---

## MCP Tools

| Tool | Description |
|------|-------------|
| `get_status()` | Health check: connectivity, last PnL timestamp |
| `get_pnl_snapshot()` | Cumulative PnL, 24h/7d windows, drawdown, open positions |
| `run_basis_strategy(is_long_basis, target_edge_bps, max_leverage)` | Execute BTC basis/funding strategy |
| `close_positions(symbol)` | Close all positions for a symbol |
| `share_pnl_to_moltbook()` | Post PnL summary to Moltbook |
| `lifi_quote_and_stub_deposit(chain_from, chain_to, amount, token)` | Cross-chain bridge quote via Li.Fi |
| `get_erc8004_registration()` | Generate ERC‑8004 agent metadata JSON |

## MCP Resources

| Resource URI | Description |
|-------------|-------------|
| `agent://performance-log` | Last 100 log events (NDJSON) |
| `agent://erc8004-metadata` | ERC‑8004 registration JSON |

---

## ERC‑8004 Registration JSON

Generated by `get_erc8004_registration()`:

```json
{
  "name": "Agent of Sats",
  "description": "ERC‑8004 BTC yield agent using Hyperliquid perps and an off-chain strategy engine.",
  "image": "ipfs://TODO",
  "services": [
    {
      "type": "mcp",
      "endpoint": "https://agent-of-sats.example.com/.well-known/agent.json"
    },
    {
      "type": "moltbook",
      "profile": "https://moltbook.com/m/agent-of-sats"
    },
    {
      "type": "log",
      "url": "hyper://TODO-or-http://log-endpoint"
    }
  ],
  "externalKeys": {
    "btc_pubkey": "TODO_BTC_PUBKEY"
  }
}
```

**To register on-chain:**
1. Pin the JSON to IPFS.
2. Call `registerAgent(ipfs://...)` on the ERC‑8004 registry contract.
3. The agent's on-chain identity now links to its MCP endpoint, Moltbook profile, and performance log.

---

## Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `HYPERLIQUID_PRIVATE_KEY` | No* | Wallet private key for live trading |
| `HYPERLIQUID_NETWORK` | No | `testnet` (default) or `mainnet` |
| `MOLTBOOK_API_URL` | No | Moltbook API base URL |
| `MOLTBOOK_API_KEY` | No* | API key for Moltbook |
| `MOLTBOOK_AGENT_ID` | No | Agent ID on Moltbook (default: `agent-of-sats`) |
| `LIFI_API_URL` | No | Li.Fi API base URL |
| `LIFI_API_KEY` | No* | Li.Fi API key |
| `PERFORMANCE_LOG_DB` | No | Path to SQLite DB (default: `data/performance_log.db`) |
| `ERC8004_BTC_PUBKEY` | No | BTC public key for ERC‑8004 metadata |
| `ERC8004_MCP_ENDPOINT` | No | MCP endpoint URL for metadata |

*When keys are not set, the respective client runs in **mock mode** – the server still starts and returns synthetic data for development and demos.

---

## License

MIT
